# Введение в упаковку

### Абстракция

Этот документ описывает текущее состояние упаковки в Python с использованием утилит распространения («**distutils**») и его расширений с точки зрения конечного пользователя, описывая, как расширить возможности стандартной установки Python путем создания пакетов и установку сторонних пакетов, модули и расширения.

Python известен своей философией «батареи включены» и имеет богатую [стандартную библиотеку](glossarii.md#standard-library). Однако, поскольку это популярный язык, количество пакетов сторонних разработчиков намного больше, чем количество пакетов [стандартной библиотеки](glossarii.md#standard-library). Таким образом, в конечном итоге становится необходимым выяснить, как пакеты [используются](ispolzovanie-paketov.md), [обнаруживаются](publikaciya-paketa.md#the-python-package-index-pypi) и [создаются](sozdanie-paketa.md) в Python.

Утомительно вручную устанавливать дополнительные пакеты, которые нужны или требуются. Поэтому у Python есть система упаковки, которая позволяет людям распространять свои программы и библиотеки в стандартном формате, что упрощает их установку и использование. Помимо распространения пакета Python также предоставляет центральную службу для добавления пакетов. Эта служба известна как [индекс пакета Python (PyPI)](publikaciya-paketa.md#the-python-package-index-pypi). Информация об индексе пакетов Python (PyPI) будет представлена в этой документации. Это позволяет [разработчику](glossarii.md#developer) без особых усилий распространять пакет среди более широкого сообщества.

Эта документация призвана объяснить, как [устанавливать пакеты](ispolzovanie-paketov.md) и [создавать пакеты](sozdanie-paketa.md) для конечного пользователя, но при этом содержит ссылки на расширенные темы.

## Экосистема упаковки

### Пакет

[Пакет](glossarii.md#package) - это просто каталог с файлом `__init__.py` внутри. Например:

```bash
$ mkdir mypackage
$ cd mypackage
$ touch __init__.py
$ echo "# A Package" > __init__.py
$ cd ..
```

Это создает пакет, который можно импортировать с помощью `import`. Пример:

```bash
>>> import mypackage
>>> mypackage.__file__
'mypackage/__init__.py'
```

### Обнаружение пакета Python

Использование [пакетов](glossarii.md#package) в текущем рабочем каталоге в большинстве случаев работает только для небольших проектов. Использование рабочего каталога в качестве расположения пакета обычно становится проблемой при распространении пакетов для более крупных систем. Следовательно, **distutils** был создан для установки **install** пакетов в **PYTHONPATH** с небольшими трудностями. **PYTHONPATH**, также в коде `sys.path`, представляет собой список мест для поиска пакетов Python. Пример:

```bash
>>> import sys
>>> sys.path
['',
 '/usr/local/lib/python2.6',
 '/usr/local/lib/python2.6/site-packages',
 ...]
>>> import mypackage
>>> mypackage.__file__
'mypackage/__init__.py'
```

Первое значение, `null` или пустая строка в `sys.path` - это текущий рабочий каталог, который позволяет находить пакеты в текущем рабочем каталоге.

{% hint style="info" %}
Ваши значения **PYTHONPATH**, вероятно, будут отличаться от отображаемых.
{% endhint %}

### Явное включение местоположения пакета

Традиционный способ установки пакетов вручную - поместить их в каталог `.../site-packages/`. Но можно установить модули Python в произвольный каталог. Например, ваш сайт может иметь соглашение о хранении всего программного обеспечения, связанного с приложением веб-сервера, в `/www`. Дополнительные модули Python могут тогда принадлежать `/www/pythonx.y/`, и для их импорта этот каталог необходимо добавить в `sys.path`. Есть несколько разных способов добавить каталог.

{% hint style="info" %}
TODO: Лучше определите, где находится каталог **.../site-packages/**.
{% endhint %}

Самый удобный способ - добавить файл конфигурации пути в каталог, который уже находится в пути Python, которым может быть каталог `.../site-packages/`. Файлы конфигурации пути имеют расширение `.pth`, и каждая строка должна содержать единственный путь, который будет добавлен к `sys.path`. (Поскольку новые пути добавляются к `sys.path`, модули в добавленных каталогах не будут заменять стандартные модули. Это означает, что вы не можете использовать этот механизм для установки фиксированных версий стандартных модулей.)

Пути могут быть абсолютными или относительными, и в этом случае они указываются относительно каталога, содержащего файл `.pth`. См. документацию модуля **site** для получения дополнительной информации.

Кроме того, есть две переменные среды, которые могут изменять `sys.path`. **PYTHONHOME** устанавливает альтернативное значение для префикса установки Python. Например, если **PYTHONHOME** установлен на `/www/python/lib/python2.6/`, путь поиска будет установлен на `['', '/www/python/lib/python2.6/', ...]`.

Переменная **PYTHONPATH** может быть установлена в список путей, которые будут добавлены в начало `sys.path`. Например, если для **PYTHONPATH** задано значение `/www/python:/opt/py`, путь поиска будет начинаться с `['', '/www/python', '/opt/py', ...]`.

{% hint style="info" %}
Каталоги должны существовать, чтобы их можно было добавить в **sys.path**. Модуль **site** удаляет несуществующие пути.
{% endhint %}

Наконец, `sys.path` - это обычный список Python, поэтому любое приложение Python может изменять его, добавляя или удаляя записи.

{% hint style="info" %}
Пакет [zc.buildout](https://pypi.org/project/zc.buildout/) изменяет **sys.path**, чтобы включить все пакеты, относящиеся к сборке. Пакет **zc.buildout** часто используется для сборки больших проектов, у которых есть внешние требования к сборке.
{% endhint %}

### Макет файла Python

В установке Python есть каталог **site-packages** внутри каталога модулей. В этом каталоге сбрасываются пакеты, установленные пользователем. В этом каталоге сохраняется файл `.pth`, который содержит пути к каталогам, в которых установлены дополнительные пакеты.

{% hint style="info" %}
Подробнее о файле **.pth** см. В разделе «[Изменение пути поиска Python](https://docs.python.org/3/install/index.html#inst-search-path)». Короче говоря, когда новый пакет устанавливается с помощью **distutils** или одного из его расширений, содержимое пакета помещается в каталог **site-packages**, а затем имя нового каталога пакета добавляется в файл **.pth**. Это позволяет Python при следующем запуске увидеть новый пакет.
{% endhint %}

## Преимущества упаковки

Несмотря на то, что можно распаковать [архивы](glossarii.md#tarball) и вручную поместить их в каталоги установки Python (см. [Явное включение местоположения пакета](vvedenie-v-upakovku.md#yavnoe-vklyuchenie-mestopolozheniya-paketa)), использование системы управления пакетами дает некоторые значительные преимущества. Вот некоторые из очевидных:

* **Управление зависимостями.** Часто пакет, который вы хотите установить, требует присутствия других. Система управления пакетами может автоматически разрешать зависимости и сделать установку простой и быстрой. Это одно из основных средств, предлагаемых **distutils**. Однако другие расширения для **distutils** лучше справляются с установкой зависимостей. (см. [distribute](ustanovka-instrumentov-upakovki.md#distribute))
* **Учет.** Менеджеры пакетов могут поддерживать списки установленных вещей и другие метаданные, такие как установленная версия и т. д., Что позволяет пользователю легко узнать, что есть в его системе. (см. [Pip устанавливает Python (Pip)](ustanovka-instrumentov-upakovki.md#pip-ustanavlivaet-python-pip))
* **Удаление.** Менеджеры пакетов могут предоставить вам способы удаления пакета из вашей среды нажатием кнопки. (см. [Pip устанавливает Python (Pip)](ustanovka-instrumentov-upakovki.md#pip-ustanavlivaet-python-pip))
* **Поиск.** Найдите пакеты, выполнив поиск в [указателе пакетов](glossarii.md#package-index) по конкретной терминологии. (см. [Pip устанавливает Python (Pip)](ustanovka-instrumentov-upakovki.md#pip-ustanavlivaet-python-pip))

## Текущее состояние упаковки

![](../../.gitbook/assets/state\_of\_packaging.jpg)

Модули **distutils** являются частью [стандартной библиотеки](glossarii.md#standard-library) и будут доступны до **Python 3.3**. Модуль **distutils** будет прекращен в **Python 3.3**. **distutils2** (обратите внимание на номер два) будет обратно совместим с **Python 2.4** и новее; и будет частью стандартной библиотеки **Python 3.3**.

Модуль **distutils** предоставляет основы для упаковки Python. К сожалению, модуль **distutils** полон проблем, поэтому небольшая группа разработчиков python работает над **distutils2**. Однако, пока **distutils2** не будет завершен, [разработчику](glossarii.md#developer) рекомендуется использовать либо чистые **distutils**, либо `Distribute package <distribute_info_>` \_ для упаковки программного обеспечения Python.

Между тем, если пакет требует пакета **setuptools**, мы рекомендуем вам установить пакет **distribute**, который предоставляет более свежую версию **setuptools**, чем исходный пакет [**setuptools**](https://pypi.org/project/setuptools/).

В будущем **distutils2** заменит **setuptools** и **distutils**, что также устранит необходимость в распространении. И, как указывалось ранее, **distutils** будет удален из стандартной библиотеки. Для получения дополнительной информации см. [Будущее упаковки](budushee-upakovki.md).

{% hint style="warning" %}
Используйте пакет [**distribute**](ustanovka-instrumentov-upakovki.md#distribute), а не пакет [**setuptools**](https://pypi.org/project/setuptools/), потому что в этом пакете есть проблемы, которые можно и не будут устранять.
{% endhint %}

{% hint style="danger" %}
Предыдущее предупреждение было актуально в 2009 году. Сейчас используется пакет **setuptools**.
{% endhint %}

## Создание микроэкосистемы с помощью virtualenv

Здесь у нас есть небольшое отступление для краткого обсуждения [виртуальных сред](virtualnye-okruzheniya.md), которые будут рассмотрены позже в этом руководстве. В большинстве случаев каталог **site-packages** является частью системной установки Python и недоступен для записи непривилегированным пользователям. Кроме того, полезно иметь надежную установку языка, который мы можем использовать. Экспериментальные пакеты не следует смешивать со стабильными, если мы хотим сохранить это качество. Чтобы добиться этого, большинство разработчиков Python используют пакет **virtualenv**, который позволяет людям создавать виртуальную установку Python. Это реплицирует каталог пакетов сайта в доступную для записи область пользователя. Каталог **site-packages**, расположенный в виртуальных средах, является дополнением к глобальному. Несмотря на то, что он ортогонален всему процессу установки пакета, это чрезвычайно полезный и естественный способ работы, поэтому все будет упомянуто еще раз. Установка и использование **virtualenv** описано в документе «[Виртуальные среды](virtualnye-okruzheniya.md)».
