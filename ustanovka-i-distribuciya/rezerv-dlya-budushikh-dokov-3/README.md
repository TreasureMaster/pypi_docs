# tox

## Добро пожаловать в проект автоматизации tox

{% hint style="info" %}
Текущая версия - 3.21.4 (для времени, когда производился перевод).
{% endhint %}

### Видение: стандартизованное тестирование на Python

**tox** направлен на автоматизацию и стандартизацию тестирования в Python. Это часть более широкого видения упрощения процесса упаковки, тестирования и выпуска программного обеспечения Python.

### Что такое tox?

**tox** - это универсальный инструмент командной строки для управления и тестирования [virtualenv](https://pypi.org/project/virtualenv/), который можно использовать для:

* проверка правильности установки вашего пакета с разными версиями Python и интерпретаторами
* запуск тестов в каждой из сред, настройка выбранного инструмента тестирования
* выступает в качестве внешнего интерфейса для серверов непрерывной интеграции, значительно сокращая количество шаблонов и объединяя тестирование на основе CI и оболочки.

### Базовый пример

Сначала установите **tox** с помощью `pip install tox`. Затем поместите основную информацию о вашем проекте и тестовых средах, в которых вы хотите запустить свой проект, в файл `tox.ini`, расположенный рядом с вашим файлом `setup.py`:

```bash
# содержание: tox.ini , поместить в тот же каталог, что и setup.py
[tox]
envlist = py27,py36

[testenv]
# установить pytest в virtualenv, где будут выполняться команды
deps = pytest
commands =
    # ПРИМЕЧАНИЕ: здесь вы можете запустить любой инструмент командной строки,
    # а не только тесты.
    pytest
```

Вы также можете попробовать создать файл `tox.ini` автоматически, запустив **tox-quickstart** и ответив на несколько простых вопросов.

Чтобы **sdist-package,** установить и протестировать свой проект на Python2.7 и Python3.6, просто введите:

```bash
tox
```

и наблюдайте, как что-то происходит (в вашей среде должны быть установлены python2.7 и python3.6, иначе вы увидите ошибки). Когда вы запустите **tox** во второй раз, вы заметите, что он работает намного быстрее, потому что он отслеживает детали **virtualenv** и не будет повторно создавать или переустанавливать зависимости. Вы также можете проверить [конфигурацию](specifikaciya-konfiguracii-tox.md) и [примеры использования](primery-tox/) **tox**, чтобы получить больше идей.

### Обзор системы

![Рабочая диаграмма tox](../../.gitbook/assets/tox\_flow.png)

**tox** примерно следует следующим этапам:

* **configuration**: загружает `tox.ini` и объединяет его с параметрами командной строки и переменными среды операционной системы.
* **packaging** (необязательно): создает исходный дистрибутив текущего проекта, вызвав

```bash
python setup.py sdist
```

Обратите внимание, что для этой операции будет использоваться та же среда Python, в которой установлен **tox** (поэтому вам необходимо убедиться, что она содержит зависимости вашей сборки). Пропустите этот шаг для проектов приложений, у которых нет `setup.py`.

* **environment** - для каждой среды **tox** (например, py27, py36) выполните:
  * **environment creation**: создает новую среду, по умолчанию используется **virtualenv**. **tox** автоматически попытается найти допустимую версию интерпретатора Python, используя имя среды (например, py27 означает Python 2.7 и значение конфигурации **basepython**) и текущее значение **PATH** операционной системы. Он создается при первом запуске только для повторного использования при последующих запусках. Если некоторые аспекты проекта изменяются, автоматически запускается воссоздание среды. Чтобы принудительно запустить воссоздание, можно вызвать команду `-r` / `--create`.
  * **install** (необязательно): устанавливает зависимости среды, указанные в разделе конфигурации **deps**, а затем более ранний пакетный исходный код. По умолчанию для установки пакетов используется **pip**, однако это можно настроить с помощью **install\_command**. Обратите внимание: **pip** не будет обновлять зависимости проекта (указанные в **install\_requires** или **extras** в `setup.py`), если какая-либо версия уже существует в виртуальной среде; поэтому мы рекомендуем воссоздавать ваши среды при изменении зависимостей вашего проекта.
  * **commands**: выполняет указанные команды в указанном порядке. Всякий раз, когда код выхода любого из них не равен нулю, останавливается и отмечается сбой среды. Обратите внимание: запуск команды с одного символа тире означает игнорирование кода выхода.
* **report** распечатайте отчет о результатах для каждой среды **tox**:

```bash
____________________ summary ____________________
py27: commands succeeded
ERROR:   py36: commands failed
```

Только если все среды работали успешно, **tox** вернет код выхода `0` (успех). В этом случае вы также увидите сообщение с `congratulations :)`.

**tox** позаботится об изоляции среды за вас: он удалит все переменные среды операционной системы, не указанные в **passenv**. Кроме того, он также изменит переменную **PATH**, чтобы ваши команды выполнялись в первую очередь в текущей активной среде **tox**. В общем, все исполняемые файлы в пути доступны в командах, но **tox** выдаст предупреждение, если это не было явно разрешено через **allowlist\_externals**.

### Текущие особенности

* **автоматизация утомительных тестовых действий, связанных с Python**
* **тестирует ваш пакет Python на множестве конфигураций интерпретаторов и зависимостей**
  * автоматическое настраиваемое (повторное) создание тестовых сред **virtualenv**
  * устанавливает ваш проект на основе `setup.py` в каждую виртуальную среду
  * агностик тестового инструмента: запускает **pytest**, **nose** или **unittest** единообразно
* [система плагинов](plaginy-tox.md) для изменения выполнения токена с помощью простых хуков.
* по умолчанию использует [**pip**](https://pypi.org/project/pip/) и [**setuptools**](https://pypi.org/project/setuptools/). Поддержка настройки команды установщика через `install_command = ARGV`.
* **кросс-платформенная Python совместимость**: CPython-2.7, 3.5 и выше, Jython и [pypy](https://www.pypy.org/).
* **кроссплатформенность**: среды в стиле Windows и Unix
* **интегрируется с серверами непрерывной интеграции**, такими как [Jenkins](https://www.jenkins.io/index.html) (ранее известный как Hudson), и помогает избежать шаблонных и специфичных для платформы взломов этапов сборки.
* **полная совместимость с devpi**: интегрирована и используется для тестирования в системе [devpi](https://devpi.net/docs/devpi/devpi/stable/%2Bd/index.html), универсальном сервере индекса PyPI и инструменте управления выпусками.
* **управляемый простым файлом конфигурации в стиле ini**
* **документированные** [примеры](primery-tox/) и [конфигурация](specifikaciya-konfiguracii-tox.md)
* **краткие отчеты** о вызовах инструментов и ошибках конфигурации
* **профессионально** [поддерживается](podderzhka-tox.md)
* поддерживает [использование разных / нескольких серверов индекса PyPI](primery-tox/bazovoe-ispolzovanie-tox.md)

### Связанные проекты

**tox** повлиял на несколько других проектов в области автоматизации тестирования Python. Если **tox** не совсем соответствует вашим потребностям или вы хотите провести дополнительные исследования, мы рекомендуем взглянуть на эти проекты:

* [Invoke](https://www.pyinvoke.org/) - это библиотека для выполнения задач общего назначения, аналогичная **Make**. **Invoke** гораздо более универсален, чем **tox**, но он не содержит специфических для Python функций тестирования, на которых специализируется **tox**.
* [Nox](https://nox.thea.codes/en/stable/) - это проект, похожий по духу на **tox**, но использует другой подход. Ключевое отличие **Nox** в том, что он использует скрипты Python вместо файла конфигурации. **Nox** может быть полезен, если вы находите конфигурацию **tox** слишком ограничивающей, но не хотите переходить к чему-то столь же универсальному, как **Invoke** или **Make**.
