# Быстрый старт setuptools

## Установка

Чтобы установить последнюю версию **setuptools**, используйте:

```bash
pip install --upgrade setuptools
```

## Краткий обзор упаковки Python

Ситуация с упаковкой Python меняется, и **setuptools** эволюционировали, чтобы обеспечивать только внутреннюю поддержку, и больше не являются де-факто инструментом упаковки на рынке. Все пакеты python должны предоставлять `pyproject.toml` и указывать серверную часть (систему сборки), которую он хочет использовать. Затем этот дистрибутив можно сгенерировать с помощью любых инструментов, которые обеспечивают функциональность, аналогичную сборке **sdist**. Хотя это может показаться обременительным, учитывая добавленные компоненты, на самом деле это значительно улучшает переносимость вашего пакета. Изменения внесены в [PEP 517](https://www.python.org/dev/peps/pep-0517/#build-requirements). Чтобы узнать больше о упаковке Python в целом, перейдите к нижней части этой страницы.

## Основное использование

Для базового использования **setuptools** вам понадобится `pyproject.toml` с точной следующей информацией, которая объявляет, что вы хотите использовать **setuptools** для упаковки вашего проекта:

```bash
[build-system]
requires = ["setuptools", "wheel"]
build-backend = "setuptools.build_meta"
```

Затем вам понадобится `setup.cfg`, чтобы указать информацию о вашем пакете, такую как метаданные, содержимое, зависимости и т. Д. Здесь мы демонстрируем минимум

```bash
[metadata]
name = mypackage
version = 0.0.1

[options]
packages = mypackage
install_requires =
  requests
  importlib; python_version == "2.6"
```

Вот как будет выглядеть ваш проект:

```bash
~/mypackage/
    pyproject.toml
    setup.cfg
    mypackage/__init__.py
```

Затем вам понадобится установщик, например [pep517](https://pypi.org/project/pep517/), который вы можете получить через `pip install pep517`. Скачав его, запустите установщик:

```bash
python -m pep517.build .
```

Теперь у вас есть готовый дистрибутив (например, файл `tar.gz` и файл `.whl` в каталоге `dist`), который вы можете загрузить в PyPI!

Конечно, прежде чем выпускать проект на PyPI, вы захотите добавить немного больше информации в свой сценарий установки, чтобы помочь людям найти или узнать о вашем проекте. И, возможно, к тому времени ваш проект вырастет и будет включать несколько зависимостей и, возможно, некоторые файлы данных и скрипты. В следующих нескольких разделах мы рассмотрим дополнительную, но важную информацию, которую вам необходимо указать для правильной упаковки вашего проекта.

## Автоматическое обнаружение пакетов

Для простых проектов обычно достаточно просто вручную добавить пакеты к ключевому слову **packages** в `setup.cfg`. Однако для очень больших проектов постоянное обновление списка пакетов может стать большим бременем. Поэтому **setuptools** предоставляет два удобных инструмента для облегчения бремени: `find:` и `find_namespace :`. Чтобы использовать его в своем проекте:

```bash
[options]
packages = find:

[options.packages.find] # опционально
include=pkg1, pkg2
exclude=pk3, pk4
```

Когда вы передаете указанную выше информацию вместе с другими необходимыми, **setuptools** проходит через каталог, указанный в **where** (здесь опущен, поскольку пакет находится в текущем каталоге), и фильтрует пакеты, которые он может найти после записи **include** (по умолчанию - none), а затем удаляет пакеты в **exclude**, которые соответствуют исключению и возвращают список пакетов Python. Обратите внимание, что каждая запись в `[options.packages.find]` необязательна. Вышеупомянутая установка также позволяет вам использовать расположение `src/` . Для получения дополнительных сведений и расширенного использования перейдите в раздел «[Обнаружение пакетов и пакет пространства имен](obnaruzhenie-paketov-i-paket-prostranstva-imen.md)».

## Точки входа и автоматическое создание сценария

Инструменты установки поддерживают автоматическое создание скриптов при установке, которые запускают код в вашем пакете, если вы укажете их с ключевым словом `entry_points`. Это то, что позволяет вам запускать такие команды, как `pip install`, вместо того, чтобы вводить `python -m pip install`. Для этого добавьте ключевое слово `entry_points` в файл `setup.cfg`:

```bash
[options.entry_points]
console_scripts =
    main = mypkg:some_func
```

Когда этот проект установлен, будет установлен основной сценарий **main**, который при вызове пользователя вызовет `some_func` в файле `__init__.py`. Для получения подробных сведений об использовании, включая управление дополнительными или необязательными зависимостями, перейдите в «[Точки входа](tochki-vkhoda.md)».

## Управление зависимостями

**setuptools** поддерживает автоматическую установку зависимостей при установке пакета. Самый простой способ включить спецификаторы требований - использовать аргумент `install_requires` в `setup.cfg`. Он принимает строку или список строк, содержащих спецификаторы требований (спецификатор версии - это один из операторов `<`, `>`, `<=`, `>=`, `==` или `!=`, за которым следует идентификатор версии):

```bash
[options]
install_requires =
    docutils >= 0.3
    requests <= 0.4
```

Когда ваш проект установлен, все еще не установленные зависимости будут найдены (через PyPI), загружены, построены (при необходимости) и установлены. Это, конечно, упрощенные сценарии. **setuptools** также предоставляет дополнительные ключевые слова, такие как `setup_requires`, позволяющие устанавливать зависимости перед запуском сценария, и `extras_requires`, которые заботятся о тех, которые необходимы автоматически сгенерированным сценариям. Он также предоставляет механизмы для обработки зависимостей, которых нет в PyPI. Для более продвинутого использования см. [Управление зависимостями в setuptools](upravlenie-zavisimostyami-v-setuptools.md).

## Включение файлов данных

В distutils традиционно разрешается установка `«data files»`, которые размещаются в определенном для платформы месте. **Setuptools** предлагает три способа указать файлы данных, которые будут включены в ваши пакеты. Для простейшего использования вы можете просто использовать ключевое слово `include_package_data`:

```bash
[options]
include_package_data = True
```

Это указывает программе **setuptools** устанавливать любые файлы данных, которые он найдет в ваших пакетах. Файлы данных должны быть указаны через файл `'MANIFEST.in'` **distutils**. Для получения дополнительной информации см. [Поддержка файлов данных](podderzhka-failov-dannykh.md).

## Режим разработки

**setuptools** позволяет вам установить пакет без копирования каких-либо файлов в ваш каталог интерпретатора (например, каталог `site-packages`). Это позволяет вам изменять исходный код, и изменения вступают в силу без необходимости перекомпоновки и переустановки. В настоящее время это несовместимо с **PEP 517**, поэтому для него требуется сценарий `setup.py` со следующим содержимым:

```python
import setuptools
setuptools.setup()
```

Затем:

```bash
pip install --editable .
```

Это создает файл ссылки в каталоге пакетов вашего сайта интерпретатора, который связан с вашим исходным кодом. Для получения дополнительной информации см .: (WIP)

## Загрузка вашего пакета в PyPI

После создания файлов распространения следующим шагом будет загрузка вашего дистрибутива, чтобы его могли использовать другие. Эта функциональность обеспечивается [twine](https://pypi.org/project/twine/), и здесь мы продемонстрируем только базовое использование.

## Переход с setup.py на setup.cfg

Чтобы избежать выполнения произвольных сценариев и шаблонного кода, мы переходим на полноценный `setup.cfg`, чтобы объявлять информацию о вашем пакете вместо запуска `setup ()`. Это неизбежно вызывает проблемы из-за другого синтаксиса. Здесь мы предоставляем краткое руководство по пониманию того, как `setup.cfg` анализируется с помощью `setuptool`, чтобы облегчить боль перехода.

## Ресурсы по упаковке Python

Упаковывать в Python сложно. Здесь мы предоставляем список ссылок для тех, кто хочет узнать больше.
