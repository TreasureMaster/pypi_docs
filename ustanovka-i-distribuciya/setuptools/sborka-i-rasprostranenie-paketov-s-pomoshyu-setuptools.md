# Сборка и распространение пакетов с помощью setuptools

**setuptools** - это набор улучшений для Python **distutils**, которые позволяют разработчикам более легко создавать и распространять пакеты Python, особенно те, которые зависят от других пакетов.

Пакеты, созданные и распространяемые с помощью **setuptools**, выглядят для пользователя как обычные пакеты Python, основанные на **distutils**.

Основные характеристики:

* Создание [Python Eggs](http://peak.telecommunity.com/DevCenter/PythonEggs) - импортируемый формат распространения одним файлом
* Расширенная поддержка доступа к файлам данных, размещенным в заархивированных пакетах.
* Автоматически включает все пакеты в исходное дерево, не перечисляя их по отдельности в `setup.py`
* Автоматически включает все соответствующие файлы в исходные дистрибутивы без необходимости создания файла `MANIFEST.in` и без принудительной регенерации файла **MANIFEST** при изменении исходного дерева.
* Автоматически создавайте сценарии оболочки или файлы Windows (консольные и графический интерфейс) `.exe` для любого количества «основных» функций в вашем проекте. (Примечание: это не замена **py2exe**; файлы `.exe` зависят от локальной установки Python.)
* Прозрачная поддержка Cython, так что ваш `setup.py` может перечислять файлы `.pyx` и продолжать работать, даже если у конечного пользователя не установлен Cython (при условии, что вы включили сгенерированный Cython C в свой исходный дистрибутив)
* Псевдонимы команд - создание ярлыков для конкретного проекта, пользователя или всего сайта для часто используемых команд и параметров.
* Разворачивает ваш проект в «режиме разработки», чтобы он был доступен в `sys.path`, но при этом его можно было редактировать прямо из источника.
* С легкостью расширяет **distutils** с помощью новых команд или аргументов `setup ()`, а также распространяет/повторно использует свои расширения для нескольких проектов без копирования кода.
* Создает расширяемые приложения и платформы, которые автоматически обнаруживают расширения, используя простые «точки входа», объявленные в сценарии установки проекта.
* Полная поддержка **PEP 420** через `find_namespace_packages ()`, которая также обратно совместима с существующей `find_packages ()` для `Python >= 3.3`.

## Руководство разработчика

## ПЕРЕХОДНОЕ ПРИМЕЧАНИЕ

**setuptools** автоматически вызывает `declare_namespace ()` во время выполнения, но в будущих версиях этого не произойдет. Это связано с тем, что функция автоматического объявления имеет некоторые отрицательные побочные эффекты, такие как необходимость импорта всех пакетов пространства имен во время инициализации среды выполнения **pkg\_resources**, а также необходимость явного импорта **pkg\_resources** до того, как какие-либо пакеты пространства имен вообще будут работать. В некоторых будущих выпусках вы будете нести ответственность за включение собственных строк объявления, а функция автоматического объявления будет удалена, чтобы избавиться от негативных побочных эффектов.

Таким образом, в течение оставшейся части текущего цикла разработки **setuptools** будет предупреждать вас об отсутствии вызовов `declare_namespace ()` в ваших файлах `__init__.py`, и вам следует исправить их как можно скорее, прежде чем поддержка совместимости будет удалена. Пакеты пространств имен без строк объявления не будут работать правильно после того, как пользователь обновится до более поздней версии, поэтому важно внести это изменение сейчас, чтобы избежать разрыва кода после. Приносим свои извинения за неудобства и благодарим за терпение.

### Проекты только для setup.cfg

_Новое в версии 40.9.0._

Если `setup.py` отсутствует в каталоге проекта при вызове сборки [PEP 517](https://www.python.org/dev/peps/pep-0517/), **setuptools** эмулирует фиктивный файл `setup.py`, содержащий только вызов `setuptools.setup ()`.

{% hint style="info" %}
**PEP 517** не поддерживает редактируемые установки, поэтому в настоящее время он несовместим с **pip install -e **_**.**_ , Поскольку **PEP 517** не поддерживает редактируемые установки.
{% endhint %}

Это означает, что у вас может быть проект Python со всей конфигурацией сборки, указанной в `setup.cfg`, без файла `setup.py`, если вы можете положиться на то, что ваш проект всегда создается с помощью интерфейса, совместимого с [PEP 517](https://www.python.org/dev/peps/pep-0517/) / [PEP 518](https://www.python.org/dev/peps/pep-0518/).

Чтобы использовать эту функцию:

* Укажите требования сборки и серверную часть сборки PEP 517 в `pyproject.toml`. Например:

```bash
[build-system]
requires = [
  "setuptools >= 40.9.0",
  "wheel",
]
build-backend = "setuptools.build_meta"
```

* Используйте интерфейс сборки, совместимый с PEP 517, например `pip >= 19` или `build`.

{% hint style="danger" %}
Поскольку **PEP 517** является новым, поддержка не является универсальной, и интерфейсы, которые поддерживают его, могут все еще содержать ошибки. Для совместимости вы можете поместить файл **setup.py**, содержащий только вызов **setuptools.setup ()**.
{% endhint %}

### API конфигурации

Некоторым средствам автоматизации может потребоваться доступ к данным из файла конфигурации.

**setuptools** предоставляет функцию `read_configuration ()` для синтаксического анализа разделов метаданных и параметров в словаре.

```python
from setuptools.config import read_configuration

conf_dict = read_configuration("/home/user/dev/package/setup.cfg")
```

По умолчанию `read_configuration ()` будет читать только файл, указанный в первом аргументе. Чтобы включить значения из других файлов конфигурации, которые могут находиться в разных местах, установите для аргумента ключевого слова _**find\_others**_ значение `True`.

Если у вас есть только файл конфигурации, а не весь пакет, вы все равно можете попытаться получить из него данные с помощью аргумента ключевого слова _**ignore\_option\_errors**_. Если для него установлено значение `True`, все параметры с ошибками, которые могут быть вызваны директивами, такими как `attr:` и другие, будут автоматически игнорироваться. Как следствие, в итоговом словаре таких опций не будет.

### Список рассылки и отслеживание ошибок

Пожалуйста, используйте [список рассылки distutils-sig](https://mail.python.org/pipermail/distutils-sig/) для вопросов и обсуждений об инструментах установки и средство отслеживания [ошибок setuptools](https://github.com/pypa/setuptools/) ТОЛЬКО для проблем, которые вы подтвердили с помощью списка, являются фактическими ошибками и которые вы сократили до минимального набора шагов для воспроизведения.
