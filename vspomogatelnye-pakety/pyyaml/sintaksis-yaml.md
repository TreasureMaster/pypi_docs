# Синтаксис YAML

Хорошее введение в синтаксис YAML - это [глава 2 спецификации YAML](https://yaml.org/spec/1.1/#id857168).

Вы также можете проверить [книгу рецептов YAML](https://yaml.org/YAML\_for\_ruby.html). Обратите внимание, что он ориентирован на реализацию Ruby и использует старый синтаксис YAML 1.0.

Здесь мы представляем наиболее распространенные конструкции YAML вместе с соответствующими объектами Python.

### Документы

Поток YAML - это набор из нуля или более документов. Пустой поток не содержит документов. Документы разделяются знаком **---**. Документы могут по желанию оканчиваться на **...**. Отдельный документ может быть помечен или не отмечен знаком **---**.

Пример неявного документа:

```yaml
- Multimedia
- Internet
- Education
```

Пример явного документа:

```yaml
---
- Afterstep
- CTWM
- Oroborus
...
```

Пример нескольких документов в одном потоке:

```yaml
---
- Ada
- APL
- ASP

- Assembly
- Awk
---
- Basic
---
- C
- C#    # Обратите внимание, что комментарии обозначаются символом "#"
- C++   # (пробел, затем #).
- Cold Fusion
```

### Последовательности блоков

В контексте блока записи последовательности обозначаются - (тире, затем пробел):

```python
# YAML
- The Dagger 'Narthanc'
- The Dagger 'Nimthanc'
- The Dagger 'Dethanc'

# Python
["The Dagger 'Narthanc'", "The Dagger 'Nimthanc'", "The Dagger 'Dethanc'"]
```

Последовательности блоков могут быть вложенными:

```python
# YAML
-
  - HTML
  - LaTeX
  - SGML
  - VRML
  - XML
  - YAML
-
  - BSD
  - GNU Hurd
  - Linux

# Python
[['HTML', 'LaTeX', 'SGML', 'VRML', 'XML', 'YAML'], ['BSD', 'GNU Hurd', 'Linux']]
```

Необязательно начинать вложенную последовательность с новой строки:

```python
# YAML
- 1.1
- - 2.1
  - 2.2
- - - 3.1
    - 3.2
    - 3.3

# Python
[1.1, [2.1, 2.2], [[3.1, 3.2, 3.3]]]
```

Последовательность блоков может быть вложена в отображение блоков. Обратите внимание, что в этом случае нет необходимости делать отступ в последовательности.

```python
# YAML
left hand:
- Ring of Teleportation
- Ring of Speed

right hand:
- Ring of Resist Fire
- Ring of Resist Cold
- Ring of Resist Poison

# Python
{'right hand': ['Ring of Resist Fire', 'Ring of Resist Cold', 'Ring of Resist Poison'],
'left hand': ['Ring of Teleportation', 'Ring of Speed']}
```

### Блочные сопоставления

В контексте блока ключи и значения сопоставлений разделяются: (двоеточие, затем пробел):

```python
# YAML
base armor class: 0
base damage: [4,4]
plus to-hit: 12
plus to-dam: 16
plus to-ac: 0

# Python
{'plus to-hit': 12, 'base damage': [4, 4], 'base armor class': 0, 'plus to-ac': 0, 'plus to-dam': 16}
```

Сложные ключи обозначены ? (знак вопроса, затем пробел):

```python
# YAML
? !!python/tuple [0,0]
: The Hero
? !!python/tuple [0,1]
: Treasure
? !!python/tuple [1,0]
: Treasure
? !!python/tuple [1,1]
: The Dragon

# Python
{(0, 1): 'Treasure', (1, 0): 'Treasure', (0, 0): 'The Hero', (1, 1): 'The Dragon'}
```

Отображение блоков может быть вложенным:

```python
# YAML
hero:
  hp: 34
  sp: 8
  level: 4
orc:
  hp: 12
  sp: 0
  level: 2

# Python
{'hero': {'hp': 34, 'sp': 8, 'level': 4}, 'orc': {'hp': 12, 'sp': 0, 'level': 2}}
```

Отображение блоков может быть вложено в последовательность блоков:

```python
# YAML
- name: PyYAML
  status: 4
  license: MIT
  language: Python
- name: PySyck
  status: 5
  license: BSD
  language: Python

# Python
[{'status': 4, 'language': 'Python', 'name': 'PyYAML', 'license': 'MIT'},
{'status': 5, 'license': 'BSD', 'name': 'PySyck', 'language': 'Python'}]
```

### Коллекции Flow

Синтаксис потоковых коллекций в YAML очень близок к синтаксису конструкторов списков и словарей в Python:

```yaml
# YAML
{ str: [15, 17], con: [16, 16], dex: [17, 18], wis: [16, 16], int: [10, 13], chr: [5, 8] }
```

```python
# Python
{'dex': [17, 18], 'int': [10, 13], 'chr': [5, 8], 'wis': [16, 16], 'str': [15, 17], 'con': [16, 16]}
```

### Скалярные величины

В YAML есть 5 стилей скаляров: простые, одинарные, двойные кавычки, буквальные и свернутые:

```yaml
# YAML
plain: Scroll of Remove Curse
single-quoted: 'EASY_KNOW'
double-quoted: "?"
literal: |    # Заимствовано из http://www.kersbergen.com/flump/religion.html
  by hjw              ___
     __              /.-.\
    /  )_____________\\  Y
   /_ /=== == === === =\ _\_
  ( /)=== == === === == Y   \
   `-------------------(  o  )
                        \___/
folded: >
  It removes all ordinary curses from all equipped items.
  Heavy or permanent curses are unaffected.
```

```python
# Python
{'plain': 'Scroll of Remove Curse',
'literal':
    'by hjw              ___\n'
    '   __              /.-.\\\n'
    '  /  )_____________\\\\  Y\n'
    ' /_ /=== == === === =\\ _\\_\n'
    '( /)=== == === === == Y   \\\n'
    ' `-------------------(  o  )\n'
    '                      \\___/\n',
'single-quoted': 'EASY_KNOW',
'double-quoted': '?',
'folded': 'It removes all ordinary curses from all equipped items. Heavy or permanent curses are unaffected.\n'}
```

У каждого стиля есть свои особенности. Обычный скаляр не использует индикаторы для обозначения начала и конца, поэтому это наиболее ограниченный стиль. Его естественные приложения - это имена атрибутов и параметров.

Используя скаляры в одинарных кавычках, вы можете выразить любое значение, не содержащее специальных символов. Для скаляров в одиночных кавычках экранирования не происходит, за исключением того, что пара соседних кавычек '' заменяется одиночной одинарной кавычкой '.

Двойные кавычки - это самый мощный стиль и единственный стиль, который может выражать любое скалярное значение. Скаляры, заключенные в двойные кавычки, позволяют избежать экранирования. Используя экранирующие последовательности **\x\*** и **\u\*\*\***, вы можете выразить любой символ ASCII или Unicode.

Есть два типа блочных скалярных стилей: буквальный и свернутый. Литеральный стиль - это наиболее подходящий стиль для больших блоков текста, таких как исходный код. Свернутый стиль аналогичен буквальному стилю, но две соседние непустые строки объединяются в одну строку, разделенную пробелом.

### Псевдонимы

~~Обратите внимание, что PyYAML еще не поддерживает рекурсивные объекты.~~

Используя YAML, вы можете представлять объекты произвольной графоподобной структуры. Если вы хотите ссылаться на один и тот же объект из разных частей документа, вам нужно использовать якоря и псевдонимы.

Якоря обозначаются индикатором **&**, а псевдонимы - знаком **` `` `**. Например, документ

```yaml
left hand: &A
  name: The Bastard Sword of Eowyn
  weight: 30
right hand: *A
```

выражает идею героя, держащего в обеих руках тяжелый меч.

PyYAML теперь полностью поддерживает рекурсивные объекты. Например, документ

```yaml
&A [ *A ]
```

создаст объект списка, содержащий ссылку на себя.

### Теги

Теги используются для обозначения типа узла YAML. Стандартные теги YAML определены на [http://yaml.org/type/index.html](http://yaml.org/type/index.html).

Теги могут быть неявными:

```yaml
boolean: true
integer: 3
float: 3.14

{'boolean': True, 'integer': 3, 'float': 3.14}
```

или явными:

```yaml
boolean: !!bool "true"
integer: !!int "3"
float: !!float "3.14"

{'boolean': True, 'integer': 3, 'float': 3.14}
```

Простые скаляры без явно определенных тегов подлежат неявному разрешению тегов. Скалярное значение проверяется по набору регулярных выражений, и если одно из них совпадает, соответствующий тег присваивается скаляру. PyYAML позволяет приложению добавлять настраиваемые преобразователи неявных тегов.
