# Регистрация Flask маршрутов URL

Обычно есть три способа определить правила для системы маршрутизации:

1. Вы можете использовать декоратор [flask.Flask.route ()](obekt-prilozheniya-flask.md#route-rule-options).
2. Вы можете использовать функцию [flask.Flask.add\_url\_rule ()](obekt-prilozheniya-flask.md#add\_url\_rule-rule-endpoint-none-view\_func-none-provide\_automatic\_options-none-options).
3. Вы можете напрямую получить доступ к базовой системе маршрутизации **Werkzeug**, которая представлена как [flask.Flask.url\_map](obekt-prilozheniya-flask.md#url\_map-none).

Переменные части маршрута можно указывать в угловых скобках (`/user/<username>`). По умолчанию переменная часть URL-адреса принимает любую строку без косой черты, однако можно указать другой преобразователь с помощью `<converter:name>`.

Части переменных передаются в функцию просмотра как аргументы ключевого слова.

Доступны следующие конвертеры:

| Конвертер    | Описание                                                        |
| ------------ | --------------------------------------------------------------- |
| _**string**_ | принимает любой текст без косой черты (по умолчанию)            |
| _**int**_    | принимает целые числа                                           |
| _**float**_  | как _**int**_, но для значений с плавающей запятой              |
| _**path**_   | как по умолчанию (_**string**_), но также допускает косую черту |
| _**any**_    | соответствует одному из предоставленных элементов               |
| _**uuid**_   | принимает строки UUID                                           |

Пользовательские конвертеры можно определить с помощью [flask.Flask.url\_map](obekt-prilozheniya-flask.md#url\_map-none).

Вот некоторые примеры:

```python
@app.route('/')
def index():
    pass

@app.route('/<username>')
def show_user(username):
    pass

@app.route('/post/<int:post_id>')
def show_post(post_id):
    pass
```

Важная деталь, о которой следует помнить, - это то, как **Flask** обрабатывает завершающие косые черты. Идея состоит в том, чтобы каждый URL оставался уникальным, чтобы применялись следующие правила:

1. Если правило заканчивается косой чертой и запрашивается пользователем без косой черты, пользователь автоматически перенаправляется на ту же страницу с прикрепленной косой чертой в конце.
2. Если правило не заканчивается косой чертой в конце и пользователь запрашивает страницу с косой чертой в конце, выдается сообщение 404 not found.

Это соответствует тому, как веб-серверы работают со статическими файлами. Это также позволяет безопасно использовать относительные цели ссылок.

Вы также можете определить несколько правил для одной и той же функции. Однако они должны быть уникальными. Также можно указать значения по умолчанию. Вот, например, определение URL-адреса, который принимает необязательную страницу:

```python
@app.route('/users/', defaults={'page': 1})
@app.route('/users/page/<int:page>')
def show_users(page):
    pass
```

Это указывает, что `/users/` будет URL-адресом для первой страницы, а `/users/page/N` будет URL-адресом для страницы `N`.

Если URL-адрес содержит значение по умолчанию, он будет перенаправлен в более простую форму с перенаправлением **301**. В приведенном выше примере `/users/page/1` будет перенаправлен на `/users/`. Если ваш маршрут обрабатывает запросы **GET** и **POST**, убедитесь, что маршрут по умолчанию обрабатывает только **GET**, поскольку перенаправления не могут сохранять данные формы.

```python
@app.route('/region/', defaults={'id': 1})
@app.route('/region/<int:id>', methods=['GET', 'POST'])
def region(id):
   pass
```

Вот параметры, которые принимают [route ()](obekt-prilozheniya-flask.md#route-rule-options) и [add\_url\_rule ()](obekt-prilozheniya-flask.md#add\_url\_rule-rule-endpoint-none-view\_func-none-provide\_automatic\_options-none-options). Единственное отличие состоит в том, что с параметром маршрута функция просмотра определяется с помощью декоратора вместо параметра **view\_func**.

| Параметр          | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| _**rule**_        | правило URL в виде строки                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| _**endpoint**_    | конечная точка для зарегистрированного правила URL. Сам **Flask** предполагает, что имя функции просмотра - это имя конечной точки, если это не указано явно.                                                                                                                                                                                                                                                                                                                                                                                                      |
| _**view\_func**_  | функция, вызываемая при обслуживании запроса к предоставленной конечной точке. Если это не предусмотрено, можно указать функцию позже, сохранив ее в словаре [view\_functions](obekt-prilozheniya-flask.md#view\_functions-none) с конечной точкой в качестве ключа.                                                                                                                                                                                                                                                                                               |
| _**defaults**_    | Словарь со значениями по умолчанию для этого правила. См. пример выше, чтобы узнать, как работают значения по умолчанию.                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| _**subdomain**_   | определяет правило для субдомена в случае, если используется сопоставление субдоменов. Если не указано, предполагается субдомен по умолчанию.                                                                                                                                                                                                                                                                                                                                                                                                                      |
| _**\*\*options**_ | параметры, которые будут перенаправлены в базовый объект [Rule](https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.Rule). Изменением в **Werkzeug** является обработка параметров метода. _**methods**_ - это список методов, которыми должно быть ограничено это правило (**GET**, **POST** и т. д.). По умолчанию правило просто прослушивает **GET** (и неявно **HEAD**). Начиная с **Flask 0.6**, **OPTIONS** неявно добавляются и обрабатываются стандартной обработкой запросов. Они должны быть указаны как аргументы ключевого слова. |
