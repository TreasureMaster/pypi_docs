# Руководство по стилю Pocoo

Руководство по стилю **Pocoo** - это руководство по стилю для всех проектов **Pocoo**, включая **Flask**. Это руководство по стилю является требованием для исправлений к **Flask** и рекомендацией для расширений **Flask**.

В целом Руководство по стилю **Pocoo** близко следует за [PEP8](https://www.python.org/dev/peps/pep-0008/) с некоторыми небольшими отличиями и расширениями.

## Генеральный план

### Отступ:

4 реальных пробела. Никакой табуляции, никаких исключений.

### Максимальная длина строки:

79 символов с мягким ограничением на 84, если это абсолютно необходимо. Старайтесь избегать слишком вложенного кода, разумно размещая операторы **break**, **continue** и **return**.

### Продолжительные длинные заявления:

Чтобы продолжить оператор, вы можете использовать обратную косую черту, и в этом случае вы должны выровнять следующую строку с последней точкой или знаком равенства или сделать отступ в четыре пробела:

```python
this_is_a_very_long(function_call, 'with many parameters') \
    .that_returns_an_object_with_an_attribute

MyModel.query.filter(MyModel.scalar > 120) \
             .order_by(MyModel.name.desc()) \
             .limit(10)
```

Если вы вставляете оператор в круглые или фигурные скобки, выровняйте их по фигурным скобкам:

```python
this_is_a_very_long(function_call, 'with many parameters',
                    23, 42, 'and even more')
```

Для списков или кортежей с большим количеством элементов разрыв сразу после открывающей скобки:

```python
items = [
    'this is the first', 'set of items', 'with more items',
    'to come in this line', 'like this'
]
```

### Пустые строки:

Функции и классы верхнего уровня разделены двумя строками, все остальное - одной. Не используйте слишком много пустых строк для разделения логических сегментов в коде. Пример:

```python
def hello(name):
    print 'Hello %s!' % name


def goodbye(name):
    print 'See you %s.' % name


class MyClass(object):
    """This is a simple docstring"""

    def __init__(self, name):
        self.name = name

    def get_annoying_name(self):
        return self.name.upper() + '!!!!111'
```

## Выражения и утверждения

### Общие правила использования пробелов:

* Нет пробелов для унарных операторов, не являющихся словами (например: `-`, `~` и т. д.), а также во внутренней части круглых скобок.
* Между бинарными операторами ставится пробел.

Хорошо:

```python
exp = -1.05
value = (item_value / item_count) * offset / exp
value = my_list[index]
value = my_dict['key']
```

Плохо:

```python
exp = - 1.05
value = ( item_value / item_count ) * offset / exp
value = (item_value/item_count)*offset/exp
value=( item_value/item_count ) * offset/exp
value = my_list[ index ]
value = my_dict ['key']
```

### Заявления Йоды недопустимы:

Никогда не сравнивайте константу с переменной, всегда переменную с константой:

Хорошо:

```python
if method == 'md5':
    pass
```

Плохо:

```python
if 'md5' == method:
    pass
```

### Сравнения:

* против произвольных типов: `==` и `!=`
* против синглтонов с `is` и `is not` (например: `foo is not None`)
* никогда не сравнивайте что-либо с `True` или `False` (например, никогда не делайте `foo == False`, вместо этого используйте `not foo`)

### Отрицательные проверки содержания:

используйте `foo not in bar` вместо `not foo in bar`

### Проверки экземпляра:

`isinstance (a, C)` вместо `type (A) is C`, но старайтесь избегать проверок экземпляров в целом. Проверить особенности.

## Соглашения об именах

* Имена классов: **CamelCase**, аббревиатуры в верхнем регистре (**HTTPWriter**, а не **HttpWriter**)
* Имена переменных: **lowercase\_with\_underscores**
* Имена методов и функций: **lowercase\_with\_underscores**
* Константы: **UPPERCASE\_WITH\_UNDERSCORES**
* предварительно скомпилированные регулярные выражения: **name\_re**

Защищенные члены имеют префикс с одинарным подчеркиванием. Двойное подчеркивание зарезервировано для классов миксинов.

К классам с ключевыми словами добавляются завершающие символы подчеркивания. Разрешены конфликты со встроенными командами, и их нельзя разрешать путем добавления подчеркивания к имени переменной. Если функции требуется доступ к затененной встроенной функции, вместо этого повторно привяжите встроенную функцию к другому имени.

Аргументы функции и метода:

* методы класса: **cls** в качестве первого параметра
* методы экземпляра: **self** как первый параметр
* лямбда-выражения для свойств могут иметь первый параметр, замененный на **x**, как в `display_name = property (lambda x: x.real_name или x.username)`

## Docstring

### Соглашения Docstring

Все строки документации отформатированы с помощью **reStructuredText** в понимании **Sphinx**. В зависимости от количества строк в строке документации они располагаются по-разному. Если это всего одна строка, закрывающая тройная кавычка находится на той же строке, что и открывающая, в противном случае текст находится на той же строке, что и открывающая цитата, и тройная кавычка, закрывающая строку на отдельной строке:

```python
def foo():
    """This is a simple docstring"""


def bar():
    """This is a longer docstring with so much information in there
    that it spans three lines.  In this case the closing triple quote
    is on its own line.
    """
```

### Заголовок модуля:

Заголовок модуля состоит из объявления кодировки **utf-8** (если используются буквы, отличные от **ASCII**, но это рекомендуется постоянно) и стандартной строки документации:

```python
# -*- coding: utf-8 -*-
"""
    package.module
    ~~~~~~~~~~~~~~

    A brief description goes here.

    :copyright: (c) YEAR by AUTHOR.
    :license: LICENSE_NAME, see LICENSE_FILE for more details.
"""
```

Имейте в виду, что надлежащие авторские права и файлы лицензий являются обязательными для утвержденных расширений **Flask**.

## Комментарии

Правила для комментариев аналогичны строкам документации. Оба отформатированы с помощью **reStructuredText**. Если комментарий используется для документирования атрибута, поставьте двоеточие после открывающего знака решетки (`#`):

```python
class User(object):
    #: the name of the user as unicode string
    name = Column(String)
    #: the sha1 hash of the password + inline salt
    pw_hash = Column(String)
```
