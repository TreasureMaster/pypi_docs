# Пользовательские страницы ошибок

**Flask** поставлен с удобной функцией [abort ()](../api-dokumentaciya-flask/poleznye-funkcii-i-klassy-flask.md#flask-abort), которая преждевременно прерывает запрос с кодом ошибки HTTP. Он также предоставит вам простую черно-белую страницу ошибки с основным описанием, но без ничего особенного.

В зависимости от кода ошибки вероятность того, что пользователь действительно увидит такую ошибку, меньше или больше.

## Коды общих ошибок

Следующие коды ошибок часто отображаются пользователю, даже если приложение ведет себя правильно:

* &#x20;**404 Not Found** - Старый добрый «парень, ты ошибся при вводе этого URL». Настолько распространено, что даже новички в Интернете знают, что 404 означает: черт, то, что я искал, там нет. Хорошая идея - убедиться, что на странице 404 действительно есть что-то полезное, по крайней мере, обратная ссылка на индекс.
* &#x20;**403 Forbidden** - Если у вас есть какой-то контроль доступа на вашем веб-сайте, вам нужно будет отправить код 403 для запрещенных ресурсов. Поэтому убедитесь, что пользователь не потеряется, когда попытается получить доступ к запрещенному ресурсу.
* &#x20;**410 Gone** _-_ Знаете ли вы, что у «404 Not Found» есть брат по имени «410 Gone»? Мало кто на самом деле реализует это, но идея заключается в том, что ресурсы, которые ранее существовали и получили удаленный ответ с 410 вместо 404. Если вы не удаляете документы из базы данных навсегда, а просто помечаете их как удаленные, сделайте пользователю одолжение и используйте 410 и отобразить сообщение о том, что то, что они искали, было удалено навсегда.
* &#x20;**500 Internal Server Error** - Обычно происходит при ошибках программирования или при перегрузке сервера. Ужасно хорошая идея - иметь там красивую страницу, потому что ваше приложение рано или поздно выйдет из строя (см. также: [Ошибки приложения](../rukovodstvo-polzovatelya-flask/oshibki-prilozheniya-flask.md)).

## Обработчики ошибок

Обработчик ошибок - это функция, которая возвращает ответ при возникновении типа ошибки, аналогично тому, как представление является функцией, которая возвращает ответ при сопоставлении URL-адреса запроса. Ему передается экземпляр обрабатываемой ошибки, который, скорее всего, является [HTTPException](https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.HTTPException). Обработчику ошибок «500 Internal Server Error» будут передаваться неперехваченные исключения в дополнение к явным 500 ошибкам.

Обработчик ошибок регистрируется с помощью декоратора [errorhandler ()](../api-dokumentaciya-flask/obekt-prilozheniya-flask.md#errorhandler) или метода [register\_error\_handler ()](../api-dokumentaciya-flask/obekt-prilozheniya-flask.md#register\_error\_handler). Обработчик может быть зарегистрирован для кода состояния, например 404, или для класса исключения.

Код состояния ответа не будет соответствовать коду обработчика. При возврате ответа от обработчика обязательно укажите соответствующий код состояния HTTP.

Обработчик «500 Internal Server Error» не будет использоваться при работе в режиме отладки. Вместо этого будет показан интерактивный отладчик.

Вот пример реализации исключения «Страница 404 не найдена»:

```python
from flask import render_template

@app.errorhandler(404)
def page_not_found(e):
    # обратите внимание, что мы явно устанавливаем статус 404
    return render_template('404.html'), 404
```

При использовании [шаблона фабрики приложений](fabriki-prilozheniya-flask.md):

```python
from flask import Flask, render_template

def page_not_found(e):
  return render_template('404.html'), 404

def create_app(config_filename):
    app = Flask(__name__)
    app.register_error_handler(404, page_not_found)
    return app
```

Пример шаблона может быть таким:

```markup
{% raw %}
{% extends "layout.html" %}
{% block title %}Page Not Found{% endblock %}
{% block body %}
  <h1>Page Not Found</h1>
  <p>What you were looking for is just not there.
  <p><a href="{{ url_for('index') }}">go somewhere nice</a>
{% endblock %}
{% endraw %}
```

## Возвращение ошибок API как JSON

При использовании **Flask** для веб-API вы можете использовать те же методы, что и выше, для возврата ответов **JSON** на ошибки **API**. [abort ()](../api-dokumentaciya-flask/poleznye-funkcii-i-klassy-flask.md#flask-abort) вызывается с параметром описания. **errorhandler ()** будет использовать это как сообщение об ошибке **JSON** и установит код состояния на **404**.

```python
from flask import abort, jsonify

@app.errorhandler(404)
def resource_not_found(e):
    return jsonify(error=str(e)), 404

@app.route("/cheese")
def get_one_cheese():
    resource = get_resource()

    if resource is None:
        abort(404, description="Resource not found")

    return jsonify(resource)
```
