# Flask-AppConfig

Настраивает приложения **Flask** каноническим способом. Также автоматически настраивает **Heroku**. Стремится стандартизировать конфигурацию.

## Описание проекта

Позволяет настроить приложение заранее заданными методами.

```python
from flask_appconfig import AppConfig

def create_app(configfile=None):
    app = Flask('myapp')
    AppConfig(app, configfile)
    return app
```

Приложение, возвращаемое **create\_app**, будет в следующем порядке:

1. Загружает настройки по умолчанию из модуля `myapp.default_config`, если он существует. (метод описан в [http://flask.pocoo.org/docs/config/#configuring-from-files](http://flask.pocoo.org/docs/config/#configuring-from-files)).
2. Загружает настройки из конфигурационного файла, имя которого указано в переменной окружения MYAPP\_CONFIG (см. ссылку из 1.).
3. Загружать **json** или строковые значения непосредственно из переменных среды, которые начинаются с префикса `MYAPP_`, т.е. установка `MYAPP_SQLALCHEMY_ECHO = true` приведет к тому, что параметр `SQLALCHEMY_ECHO` будет иметь значение `True`.

Любое из этих поведений можно изменить или отключить, передав соответствующие параметры конструктору или **init\_app ()**.

## Поддержка Heroku

**Flask-AppConfig** поддерживает настройку ряда сервисов через **HerokuConfig**:

```python
from flask_appconfig import HerokuConfig

def create_app(configfile=None):
    app = Flask('myapp')
    HerokuConfig(app, configfile)
    return app
```

Работает аналогично приведенному выше примеру, но переменные среды, установленные различными дополнениями **Heroku**, будут анализироваться как **json** и соответственно преобразовываться в переменные конфигурации. Например, при включении [Mailgun](https://elements.heroku.com/addons/mailgun) конфигурация [Flask-Mail](flask-mail/) будет автоматически настроена правильно.

## Использование "ENV-only"

Если вы хотите использовать только функции анализа среды **Flask-AppConfig**, отображаются соответствующие функции:

```python
from flask_appconfig.heroku import from_heroku_envvars
from flask_appconfig.env import from_envvars

# из переменных среды. обратите внимание, что вам нужно установить префикс,
# поскольку автоматическое обнаружение невозможно без объекта приложения
from_envvars(app.config, prefix=app.name.upper() + '_')

# также возможно: анализировать значения конфигурации heroku
# любой dict-подобный объект будет работать как первый параметр
from_heroku_envvars(app.config)
```

## Установка

Через [PyPI](https://pypi.org/project/flask-appconfig/):

```bash
$ pip install flask-appconfig
```

Требуется Python 2.7.

## Утилита flask

Если вы хотите быстро начать работу, не задумываясь о написании сценария запуска, утилита flask поддерживает шаблон `create_app/factory`:

```bash
$ flask --app=myapp dev
```

Это импортирует модуль **myapp** и вызовет `myapp.run (debug = True)`. Также могут пригодиться другие варианты:

```bash
$ flask --app=myapp dev -S -p 8080
```

Запускает приложение на порту 8080 с включенным SSL. Вы также можете установить переменную среды **FLASK\_APP** или установить **FLASK\_APP** внутри `.env` и опустить параметр `--app`. Обратите внимание, что утилита **flask** может быть изменена, так как она будет конфликтовать с функциональностью интерфейса командной строки **Flask 1.0**. В настоящее время API закрывается, но он увидит изменения после выпуска **Flask 1.0**.

## Поддержка Flask-Debug и Flask-DebugToolbar

**flask** автоматически активирует [Flask-Debug](https://github.com/mbr/flask-debug) и [Flask-DebugToolbar](https://flask-debugtoolbar.readthedocs.io/en/latest/) в вашем приложении; это позволяет установить его локально, при этом не нужно устанавливать отладочный код в производственной среде. Вы можете подавить это поведение с помощью флага `-E/--no-flask-debug`. Обратите внимание, что эти функции доступны только при установке любого из этих расширений вручную; они не являются зависимостями от **Flask-Appconfig**.

## Мысли о конфигурации

Существует множество способов настроить приложение **Flask**, и часто в спешке выбираются неоптимальные из них. Это расширение предназначено для выполнения трех задач:

1. Установите «стандарт» настройки гибкости и соответствия официальной документации и (что я считаю) передовым практикам.
2. Сделайте как можно более удобным предоставление этих методов конфигурации в приложении.
3. Автоматическая настройка на **Heroku** в максимально возможной степени без ущерба для пунктов 1 и 2.

[12factor.net](https://12factor.net/), похоже, содержит много хороших мыслей по этому поводу, и **Flask-Appconfig** должен помочь вам в написании приложения, которое следует изложенным в нем принципам.

### Предоставление значений по умолчанию

Значения по умолчанию должны быть включены и переопределены, без изменения файла, содержащего значения по умолчанию.

### Раздельный код и конфигурация

Должна быть возможность установить приложение в доступное только для чтения (возможно, общесистемное) расположение, без необходимости хранить файлы конфигурации (или, что еще хуже, модули конфигурации) внутри своих папок.

Это возможно с помощью переменных среды и папок экземпляров. В качестве дополнительного преимущества нет необходимости хранить конфигурацию вместе с кодом в системе управления версиями.

### Для большинства развертываний с использованием шаблона фабричного метода код не требуется

При развертывании с помощью gunicorn передачи `myapp: create_app ()` достаточно для создания экземпляра приложения, шаблонный код для создания приложения WSGI не требуется.

### Несколько экземпляров

Также возможно выполнение нескольких приложений внутри одного интерпретатора. Хотя это немного сложнее и иногда может нарушать указанное выше правило «без кода», это все же просто, если использовать параметры файла конфигурации.

## Развитие

**Flask-AppConfig** находится в стадии «концептуальной разработки». API или семантика могут измениться в будущем. Отправьте запросы на включение дополнительных приложений **Heroku**, которые будут поддерживаться. Отправить отзыв по почте.

## Журнал изменений

Обратно-несовместимые изменения, как они были внесены:

### 0.11

* Инструмент **flaskdev** был заменен на **flask**.
* При использовании нового инструмента **flask** автоматическая перезагрузка также изменится по умолчанию. Если в код введена синтаксическая ошибка, приложение по умолчанию попытается перезапуститься через две секунды вместо сбоя. Это можно подавить с помощью флага «`–extended-reload 0`».
* Если импорт приложения завершится неудачно, **flask** добавит `'.'` в `sys.path` и попробует импортировать еще раз.
* Добавлены экспериментальные команды **serve** и **db**.

### 0.4

* Переменные среды по умолчанию больше не имеют префикса `FLASK_`_,_ вместо этого используется `APPNAME_` (при этом **APPNAME** является именем приложения в верхнем регистре).
* **MYAPP\_SETTINGS** стал **MYAPP\_CONFIG**, `default_settings` стал `default_config`.
