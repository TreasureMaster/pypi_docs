# Интернационализация (i18n)

Локализация строк в **WTForms** - это тема, которая часто появляется в списке рассылки. Хотя **WTForms** не предоставляет собственной библиотеки локализации, вы можете легко интегрировать **WTForms** практически с любой структурой, подобной `gettext`.

В **WTForms** большая часть передаваемых сообщений предоставляется вами, пользователем. Однако существует поддержка перевода некоторых встроенных сообщений в **WTForms** (таких как ошибки, возникающие во время принуждения данных), чтобы пользователь мог убедиться, что взаимодействие с пользователем согласовано.

### Перевод сообщений, предоставленных пользователями

На самом деле это не какая-то конкретная функция в **WTForms**, но, поскольку вопрос задается так часто, нам нужно решить его здесь: **WTForms не переводит никакие строки, предоставленные пользователем**.

Это не значит, что их нельзя перевести, но вы должны сами решать, как переводить любые передаваемые сообщения. **WTForms** ждет до последнего момента (обычно времени проверки), прежде чем делать что-либо с переданным сообщением (например, интерполировать строки), что дает вам возможность, например, измените локаль до того, как произойдет проверка, если вы используете подходящий «ленивый прокси».

Вот простой пример того, как можно предоставить переведенные строки в **WTForms**:

```python
from somelibrary import ugettext_lazy as _
from wtforms import Form, StringField, IntegerField, validators as v

class RegistrationForm(Form):
    name = StringField(_(u'Name'), [v.InputRequired(_(u'Please provide your name'))])
    age = IntegerField(
        _(u'Age'),
        [v.NumberRange(min=12, message=_(u'Must be at least %(min)d years old.'))]
    )
```

Метка поля остается неизменной до времени визуализации в шаблоне, поэтому при желании вы можете легко обеспечить перевод меток полей. Кроме того, сообщения валидатора со строками формата не интерполируются до тех пор, пока не будет запущена валидация, поэтому вы также можете предоставить локализацию там.

### Перевод встроенных сообщений

В **WTForms** есть некоторые сообщения, которые предоставляются фреймворком, а именно сообщения валидатора по умолчанию и ошибки, возникающие на этапе обработки (принуждения данных). Например, в случае с **IntegerField** выше, если кто-то ввел значение, которое недействительно как целое число, то будет отображаться сообщение типа «Недопустимое целочисленное значение».

### Использование встроенного поставщика переводов

**WTForms** теперь включает базового поставщика переводов, который использует модуль **stdlib** _**gettext**_ для локализации строк на основе информации о локали, распространяемой вместе с пакетом. Включены локализации для нескольких языков, и мы надеемся, что скоро их будет больше.

Чтобы использовать встроенный поставщик переводов, просто передайте языки локали в качестве локалей в мета-разделе конструктора **constructor** вашей формы:

```python
form = MyForm(request.form, meta={'locales': ['en_US', 'en']})
```

В качестве альтернативы, если вы локализуете приложение на уровне всего приложения, вы можете определить локали на мета-уровне в подклассе **Form**:

```python
class MyBaseForm(Form):
    class Meta:
        locales = ['es_ES', 'es']
```

Теперь просто сделайте все ваши формы подклассом **MyBaseForm**, и все ваши сообщения по умолчанию будут выводиться на испанском языке.

### Написание собственного поставщика переводов

В этом случае мы предоставляем возможность предоставить объект перевода в подклассе **Form**, который затем будет вызываться для перевода встроенных строк.

Пример написания простого объекта переводов:

```python
from mylibrary import ugettext, ungettext
from wtforms import Form

class MyTranslations(object):
    def gettext(self, string):
        return ugettext(string)

    def ngettext(self, singular, plural, n):
        return ungettext(singular, plural, n)

class MyBaseForm(Form):
    def _get_translations(self):
        return MyTranslations()
```

Затем вы могли бы использовать этот новый базовый класс **Form** в качестве базового класса для любых форм, которые вы создаете, и любые встроенные сообщения от **WTForms** будут передаваться вашим реализациям `gettext/ngettext`.

Вы управляете конструктором объекта, его жизненным циклом и всем остальным, чтобы вы могли, например, передать экземпляр языкового стандарта для конкретной формы конструктору объекта перевода и все остальное, что вам нужно сделать, чтобы переводы работали на вас.
